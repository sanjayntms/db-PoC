<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdventureWorks Products</title>
    <style>
        body {
            font-family: sans-serif;
        }
        h2 {
            margin-top: 20px;
        }
        #addProductForm div {
            margin-bottom: 10px;
        }
        #addProductForm label {
            display: inline-block;
            width: 150px;
            text-align: right;
            margin-right: 10px;
        }
        #addProductForm input[type="text"],
        #addProductForm input[type="number"] {
            width: 200px;
            padding: 5px;
        }
        #addProductForm button[type="submit"] {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        #addProductMessage {
            font-weight: bold;
        }
        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>AdventureWorks Products</h1>

    <h2>Add New Product</h2>
    <form id="addProductForm">
        <div>
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div>
            <label for="productNumber">Product Number (Optional):</label>
            <input type="text" id="productNumber" name="productNumber">
        </div>
        <div>
            <label for="listPrice">List Price:</label>
            <input type="number" id="listPrice" name="listPrice" step="0.01" required>
        </div>
        <button type="submit">Add Product</button>
        <div id="addProductMessage" style="margin-top: 10px;"></div>
    </form>

    <hr>

    <div id="productTableContainer">
        <p>Loading products...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addProductForm = document.getElementById('addProductForm');
            const addProductMessage = document.getElementById('addProductMessage');
            const productTableContainer = document.getElementById('productTableContainer');

            async function fetchProducts() {
                try {
                    const response = await fetch('https://ntmsadvapp.azurewebsites.net/api/products');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const products = await response.json();
                    displayProducts(products);
                } catch (error) {
                    productTableContainer.innerHTML = `<p>Error loading products: ${error.message}</p>`;
                    console.error('Error fetching products:', error);
                }
            }

            function displayProducts(products) {
                productTableContainer.innerHTML = ''; // Clear the loading message

                if (products && products.length > 0) {
                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    const tbody = document.createElement('tbody');
                    const headerRow = document.createElement('tr');

                    const headers = ['Product ID', 'Name', 'Price'];
                    headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    products.forEach(product => {
                        const row = document.createElement('tr');
                        const idCell = document.createElement('td');
                        idCell.textContent = product.ProductID;
                        const nameCell = document.createElement('td');
                        nameCell.textContent = product.Name;
                        const priceCell = document.createElement('td');
                        priceCell.textContent = product.ListPrice;

                        row.appendChild(idCell);
                        row.appendChild(nameCell);
                        row.appendChild(priceCell);
                        tbody.appendChild(row);
                    });

                    table.appendChild(tbody);
                    productTableContainer.appendChild(table);
                } else {
                    productTableContainer.innerHTML = '<p>No products found.</p>';
                }
            }

            addProductForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the default form submission

                const name = document.getElementById('name').value;
                const productNumber = document.getElementById('productNumber').value;
                const listPrice = parseFloat(document.getElementById('listPrice').value);

                const newProduct = {
                    Name: name,
                    ProductNumber: productNumber || null,
                    ListPrice: listPrice
                };

                try {
                    const response = await fetch('https://ntmsadvapp.azurewebsites.net/api/products', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(newProduct)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        addProductMessage.textContent = `Product created successfully! Product ID: ${result.productId}`;
                        addProductForm.reset(); // Clear the form
                        fetchProducts(); // Refresh the product list
                    } else {
                        addProductMessage.textContent = `Error creating product: ${result.error || 'Something went wrong'}`;
                        console.error('Error creating product:', result);
                    }
                } catch (error) {
                    addProductMessage.textContent = `Error creating product: ${error.message}`;
                    console.error('Error sending create request:', error);
                }
            });

            // Call the function to fetch products when the page loads
            fetchProducts();
        });
    </script>
</body>
</html>
